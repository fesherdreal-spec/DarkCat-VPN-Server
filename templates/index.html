{% extends "base.html" %}

{% block title %}DarkCat VPN - –¢–≤–æ–π —É—é—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç{% endblock %}

{% block content %}
<article class="download-card">
    <header>
        <h2>–¢–≤–æ–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.<br>–¢–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞.</h2>
        <p>–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø, —Ç—ë–ø–ª—ã–π –∏ –ª–∞–º–ø–æ–≤—ã–π.</p>
    </header>
    
    <div class="card-body">
        <p style="margin-bottom: 1rem;">–ù–∏–∫–∞–∫–∏—Ö —Å–ª–æ–∂–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –í—Å—ë —Å–∞–º–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞–∫ –∫–æ—Ç–∏–∫ –º—É—Ä—á–∏—Ç.</p>
        
        <ul class="features-list">
            <li><span>üîí</span> –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø—Ä–æ–∫—É—Å–∏—Ç—å</li>
            <li><span>üöÄ</span> –°–∫–æ—Ä–æ—Å—Ç—å –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º —Ç—ã–≥—ã–¥—ã–∫ –≤ 3 –Ω–æ—á–∏</li>
            <li><span>üêæ</span> –ü–æ–ª–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å (–º—ã –Ω–µ —Å–ª–µ–¥–∏–º)</li>
        </ul>
    </div>

    <footer>
        <button data-target="instruction-modal" class="cta-button">
           –°–∫–∞—á–∞—Ç—å –∫–ª–∏–µ–Ω—Ç
        </button>
        <p style="font-size: 0.8rem; margin-top: 1rem; color: var(--color-subtext); display: flex; justify-content: center;">
            –í–µ—Ä—Å–∏—è: {{ version }} | –î–ª—è Windows 10/11
        </p>
    </footer>
</article>

<dialog id="instruction-modal">
  <article style="border: 1px solid var(--color-accent);">
    <header>
      <a href="#close" aria-label="Close" class="close" data-target="instruction-modal"></a>
      <strong>üê± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏—Ä—É—á–µ–Ω–∏—é</strong>
    </header>
    <div class="modal-body">
        <p>–í—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ, –º—Ä—Ä:</p>
        <ol>
            <li>–•–≤–∞—Ç–∞–π –∞—Ä—Ö–∏–≤ <code style="color: var(--color-accent);">{{ filename }}</code></li>
            <li><strong>–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</strong> —Ä–∞—Å–ø–∞–∫—É–π –µ–≥–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–∞–ø–æ—á–∫—É.</li>
            <li>–ó–∞–ø—É—Å–∫–∞–π <code style="color: var(--color-success);">DarkCatVPN.exe</code> –∏ –∂–º–∏ –±–æ–ª—å—à—É—é –∫–Ω–æ–ø–∫—É.</li>
        </ol>
        <p style="font-size: 0.9em; color: var(--color-subtext);">
            <em>–ï—Å–ª–∏ Windows —Ä—É–≥–∞–µ—Ç—Å—è –∏ –Ω–µ –ø—É—Å–∫–∞–µ—Ç ‚Äî —Å–∫–∞–∂–∏ –µ–º—É "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" -> "–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ". –û–Ω –ø—Ä–æ—Å—Ç–æ –≤—Ä–µ–¥–Ω—ã–π –ø—ë—Å. :3</em>
        </p>
    </div>
    <footer>
        <a href="#close" role="button" class="secondary" data-target="instruction-modal">
            –Ø –ø–µ—Ä–µ–¥—É–º–∞–ª
        </a>
        <a href="{{ download_url }}" role="button" class="cta-button" target="_blank">
           –°–∫–∞—á–∞—Ç—å (–ú—è—É!) ‚¨á
        </a>
    </footer>
  </article>
</dialog>

<script>
  const isOpenClass = 'modal-is-open';
  const openingClass = 'modal-is-opening';
  const closingClass = 'modal-is-closing';
  const animationDuration = 400; // ms
  let visibleModal = null;

  const toggleModal = event => {
    event.preventDefault();
    const modal = document.getElementById(event.currentTarget.getAttribute('data-target'));
    (typeof(modal) != 'undefined' && modal != null) && isModalOpen(modal) ? closeModal(modal) : openModal(modal);
  }

  const isModalOpen = modal => {
    return modal.hasAttribute('open') && modal.getAttribute('open') != 'false' ? true : false;
  }

  const openModal = modal => {
    if (isModalOpen(modal)) return;
    modal.setAttribute('open', true);
    document.documentElement.classList.add(isOpenClass, openingClass);
    setTimeout(() => {
      visibleModal = modal;
      document.documentElement.classList.remove(openingClass);
    }, animationDuration);
  }

  const closeModal = modal => {
    visibleModal = null;
    document.documentElement.classList.add(closingClass);
    setTimeout(() => {
      modal.removeAttribute('open');
      document.documentElement.classList.remove(closingClass, isOpenClass);
    }, animationDuration);
  }

  document.addEventListener('click', event => {
    if (visibleModal != null) {
      const modalContent = visibleModal.querySelector('article');
      const isClickInside = modalContent.contains(event.target);
      if (!isClickInside && event.target.getAttribute('data-target') !== visibleModal.id) {
        closeModal(visibleModal);
      }
    }
  });

  document.addEventListener('keydown', event => {
    if (event.key === 'Escape' && visibleModal != null) {
      closeModal(visibleModal);
    }
  });

  const btns = document.querySelectorAll('[data-target]');
  btns.forEach(btn => btn.addEventListener('click', toggleModal));
</script>
{% endblock %}